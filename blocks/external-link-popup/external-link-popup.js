import{analyticsModal,analyticsClick,analyticsNavigation}from"../../scripts/analytics.js";import{getMetadata}from"../../scripts/aem.js";import{loadFragment}from"../fragment/fragment.js";import{marketoFn}from"../../scripts/tools.js";function decDialog(e,n){return{dialogInnerHTML:e?.children[0]?.innerHTML,CloseHTML:e?.children[1]?.querySelector("p")?.innerHTML,ContinueHTML:n?.children[0]?.querySelector("p")?.innerHTML}}function isMedAdvSection(e){return!!e.includes("/medicare-advantage")}function isCobrandedWebsite(e,n){var n=new URL(n),e=e.get(n.origin),t=e?.size;if(e&&1===t&&e.path[0]===n.pathname)return{partner:e.partner[0],service:e.service[0],domain:e.domain[0]};if(1<t){t=n.pathname,n=e.path.indexOf(t);if(0<=n)return{partner:e.partner[n],service:e.service[n],domain:e.domain[n]}}return null}function isContactURL(e){return e.href.startsWith("mailto:")||e.href.startsWith("tel:")}function isInernaltoMedicare(e,n){return!n.nextElementSibling?.classList.contains("siteheader-subnav")&&!e.has(n.href)&&(e=new URL(n.href).origin===window.location.origin,!isMedAdvSection(n.href))&&e}function isUrlExternal(e){if(e.children[0]?.classList.contains("icon-regular--arrow-up-right-from-square")||e.children[0]?.classList.contains("icon-solid--arrow-up-right-from-square")||e.children[0]?.classList.contains("icon-solid--square-arrow-up-right")||e.children[0]?.classList.contains("icon-arrow-up-right-from-square"))return!0;var n=e.nextElementSibling;if(n?.classList.contains("icon-arrow-up-right-from-square")||n?.classList.contains("icon-solid--arrow-up-right-from-square")||n?.classList.contains("icon-regular--arrow-up-right-from-square")||n?.classList.contains("icon-solid--square-arrow-up-right"))return!0;if(n?.classList.contains("fa-arrow-up-right-from-square")||n?.classList.contains("fa-square-arrow-up-right"))return!0;if(!n){n=e.parentElement;if(n&&1===n.children.length&&n.children[0]===e){e=n.nextElementSibling;if(("SPAN"===e?.tagName||"ICON"===e?.tagName)&&(e?.classList.contains("icon-arrow-up-right-from-square")||e?.classList.contains("icon-solid--arrow-up-right-from-square")||e?.classList.contains("icon-regular--arrow-up-right-from-square")||e?.classList.contains("icon-solid--square-arrow-up-right")||e?.classList.contains("fa-arrow-up-right-from-square")))return!0}}return!1}function isExternalPDF(e){var n=new URL(e).origin!==window.location.origin,t=e.nextElementSibling;if(t&&n){if(t.classList.contains("icon-solid--file-pdf")||t.classList.contains("icon-regular--file-pdf")||t.classList.contains("icon-file-pdf"))return!0}else if(n){t=e.parentElement.nextElementSibling;if(t&&(t.classList.contains("icon-solid--file-pdf")||t.classList.contains("icon-regular--file-pdf")||t.classList.contains("icon-file-pdf")))return!0}return!1}export default async function decorate(){let f={open:{cobranded:0,medicareexternal:0,medicareinternal:0,downloadmodal:0},close:{cobranded:0,medicareexternal:0,medicareinternal:0,downloadmodal:0}},e=document.querySelector("body"),a=document.createElement("p");a.innerHTML="mktoForm_1157";var n=getMetadata("/content-fragments/modals/cobranded"),t=getMetadata("/content-fragments/modals/medicare-advantage"),i=getMetadata("/content-fragments/modals/adhoc"),n=n?new URL(n,window.location).pathname:"/content-fragments/modals/cobranded",t=t?new URL(t,window.location).pathname:"/content-fragments/modals/medicare-advantage",i=i?new URL(i,window.location).pathname:"/content-fragments/modals/adhoc";let p=new Map,h=new Set,g=new Set,L=isMedAdvSection(window.location.href);var r=await fetch("/modal-urls.json"),[n,t,i]=await Promise.allSettled([loadFragment(n),loadFragment(t),loadFragment(i)]),n=n.value,t=t.value;let w=i.value;var o,l,i=document.querySelector("body");r.ok&&({cobrandedurls:r,medicareExturls:o,medicareInturlsExclusion:l}=await r.json(),r.data.forEach(e=>{var n=new URL(e.url),t=p.get(n.origin);t?(t.size+=1,t.partner.push(""+e.partner.trim()),t.domain.push(""+e.domain.trim()),t.service.push(""+e.service.trim()),t.path.push(n.pathname),p.set(n.origin,t)):p.set(n.origin,{size:1,service:[""+e.service.trim()],partner:[""+e.partner.trim()],domain:[""+e.domain.trim()],path:[n.pathname]})}),o.data.forEach(e=>{e=new URL(e.url);h.add(e.origin)}),l.data.forEach(n=>{try{new URL(n.url);g.add(n.url)}catch(e){g.add(window.location.origin+n.url)}}));let[v,y]=Array.from(n?.querySelector(".cobranded-modal-external")?.children||[]),[b,M]=Array.from(t?.querySelector(".medadv-modal-external")?.children||[]),[T,_]=Array.from(t?.querySelector(".medadv-modal-internal")?.children||[]),x=document.createElement("dialog"),E=document.createElement("div"),A=(E.classList.add("content-box"),x.append(E),document.createElement("button")),H=document.createElement("button"),k=document.createElement("a");A.setAttribute("type","button"),A.ariaLabel="Close",A.setAttribute("autofocus",!0),A.classList.add("close-btn"),x.classList.add("modal-popup"),k.classList.add("modal-popup-link"),H.classList.add("modal-popup-cancel"),i.append(x),setTimeout(()=>{document.body.querySelectorAll("a").forEach(e=>{if(e.href&&!isContactURL(e)){var n=new URL(e.href);if(!n.origin?.includes("digital-assets.wellmark.com")){let i=w&&e.getAttribute("href")?.includes("#adhoc"),r=e?.getAttribute("href")?.includes("#downloadmodal-"),o=r&&e.getAttribute("href")?.split("-")[1];if(r&&(e.href="#"+e.href.split("#")[1]),!i&&!r&&e.getAttribute("href").includes("#")){var n=new URL(e.href),t=isMedAdvSection(window.location.href);if(n.origin===window.location.origin&&!t)return}let l=!i&&!r&&!isContactURL(e)&&v&&isCobrandedWebsite(p,e.href),d=!l&&L&&!i&&!r&&!isContactURL(e)&&b&&h.has(e.origin),s=!l&&L&&!i&&!r&&!isContactURL(e)&&T&&isInernaltoMedicare(g,e),c=i?e.getAttribute("href")?.split("-")?.[1]:null;c&&(f.open["adhoc"+c]=0,f.close["adhoc"+c]=0);n=i&&w.querySelector(".adhocname-"+c);let[m,u]=i&&n?Array.from(n?.children):[];!r||(f.open["downloadmodal-"+o]=0,f.close["downloadmodal-"+o]=0,a.innerText="mktoForm_"+o,(t=document.createElement("div")).style.display="none",t.classList.add("download-modal-container","marketo-form","download-form-container-"+o),x.querySelector(".mktoform-"+o))||(document.body.append(t),marketoFn(t,a),x.append(t)),l||d||s||(n=isUrlExternal(e),t=isExternalPDF(e),(n||t)&&(e.target="_blank")),(l||d||s||i||r)&&(e.ariaHasPopup="dialog"),e.addEventListener("click",function(t){if(this.href&&!isContactURL(this)&&(l||d||s||i||r)){t.preventDefault();let e=null,n=null;var a;r&&(x.setAttribute("modalName","downloadmodal-"+o),A.innerHTML='<span class="icon icon-solid--x"><i style="height:16px; width:16px" class="fa-solid fa-x" data-icon-name="regular--circle-xmark"></i></span>',E.innerHTML="",k.style.display="none",H.style.display="none",x.querySelector(".download-form-container-"+o).style.display="block",f.open["downloadmodal-"+o]+=1,e="downloadmodal-"+o,n=f.open["downloadmodal-"+o]),l?(x.classList.add("cobranded-external"),x.setAttribute("modalName","cobranded"),t=decDialog(v,y),E.innerHTML=t.dialogInnerHTML.replaceAll("{{domain}}",l.domain).replaceAll("{{partner}}",l.partner).replaceAll("{{service}}",l.service),A.innerHTML=t.CloseHTML,k.innerHTML=t.ContinueHTML,k.target="_blank",k.href=this.href,H.innerHTML="Cancel",f.open.cobranded+=1,e="cobranded",n=f.open.cobranded):d?(x.classList.add("medicare-external"),x.setAttribute("modalName","medicareexternal"),t=decDialog(b,M),E.innerHTML=t.dialogInnerHTML,A.innerHTML=t.CloseHTML,k.innerHTML=t.ContinueHTML,k.href=this.href,k.setAttribute("target","_blank"),H.innerHTML="Cancel",f.open.medicareexternal+=1,e="medicareexternal",n=f.open.medicareexternal):s?(x.classList.add("medicare-internal"),x.setAttribute("modalName","medicareinternal"),t=decDialog(T,_),E.innerHTML=t.dialogInnerHTML,A.innerHTML=t.CloseHTML,k.innerHTML=t.ContinueHTML,k.target="",k.href=this.href,H.innerHTML="Cancel",f.open.medicareinternal+=1,e="medicareinternal",n=f.open.medicareinternal):i&&(t=this.href.replace(/#adhoc-[^/#?]*$/,""),x.setAttribute("modalName","adhoc"+c),x.classList.add("adhoc"),a=decDialog(m,u),E.innerHTML=a.dialogInnerHTML,A.innerHTML=a.CloseHTML,k.setAttribute("modal","adhoc"),k.innerHTML=a.ContinueHTML,k.href=t,H.innerHTML="Cancel",f.open["adhoc"+c]+=1,e="adhoc"+c,n=f.open["adhoc"+c]),r||(k.style.display="flex",H.style.display="flex"),x.append(k),x.append(H),x.append(A),x.showModal();try{analyticsModal({modal_action:"open",modal_location:window.location.href,modal_name:e,modal_impression:n})}catch(e){console.log("------------Analytics Error----------",e)}}})}}}),x.addEventListener("click",e=>{var{left:n,right:t,top:a,bottom:i}=x.getBoundingClientRect(),{clientX:e,clientY:r}=e;!(e<n||t<e||r<a||i<r)||0===e&&0===r||x.close()}),x.addEventListener("keydown",e=>{var n=x.getAttribute("modalname"),n=n.startsWith("download")?n.split("-")[1]:null,t=x.querySelector(`.download-form-container-${n} input`),a=x.querySelector(`.download-form-container-${n} .mktoform-`+n),a=a&&"none"===window.getComputedStyle(a).display,n=[...x.querySelectorAll(`.download-form-container-${n} .mkto-tymsg-block a`)].filter(e=>"none"!==window.getComputedStyle(e).display);if("Tab"===e.key)if(t){if(e.shiftKey){if(a&&document.activeElement===n[0])return e.preventDefault(),void A.focus();document.activeElement===t&&(e.preventDefault(),A.focus())}else if(document.activeElement===A){if(e.preventDefault(),a)return void n[0]?.focus();t.focus()}}else e.shiftKey?document.activeElement===k&&(e.preventDefault(),A.focus()):document.activeElement===A&&(e.preventDefault(),k.focus())}),k.addEventListener("click",function(e){"adhoc"===this.getAttribute("modal")&&(new URL(this.href).pathname===window.location.pathname?(this.setAttribute("navigate","true"),e.preventDefault()):analyticsNavigation({nav_click_image_alt_text:"undefined",nav_click_text:k.innerText,nav_menu_type:"body",asset_name:"undefined",asset_type:"undefined",asset_id:"undefined"}));e=x.getAttribute("modalname");x.close(),"medicareinternal"===e?analyticsNavigation({nav_click_image_alt_text:"undefined",nav_click_text:k.innerText,nav_menu_type:"body",asset_name:"undefined",asset_type:"undefined",asset_id:"undefined"}):"cobranded"!==e&&"medicareexternal"!==e||analyticsClick({link_classes:k.getAttribute("class"),link_domain:new URL(k.href).hostname,link_id:k.getAttribute("id")||"undefined",link_text:k.innerText,link_url:k.href,asset_name:"undefined",asset_type:"undefined",asset_id:"undefined",outbound:!0})}),H.addEventListener("click",()=>{x.close(),e.classList.remove("modal-popup-open")}),A.addEventListener("click",()=>{x.close(),e.classList.remove("modal-popup-open")}),x.addEventListener("close",()=>{var e=x.getAttribute("modalname");k.removeAttribute("modal"),f.close[e]+=1,x.classList.forEach(e=>{"modal-popup"!==e&&x.classList.remove(e),x.querySelectorAll(".download-modal-container").forEach(e=>{e.style.display="none"})}),analyticsModal({modal_action:"close",modal_location:window.location.href,modal_name:e,modal_impression:f.close[e]})})},1e3)}