import{getDocFileExtension}from"../../scripts/tools.js";let allDownloadableLinks=[],downloadBtn=document.createElement("a"),generateBlob=()=>Promise.all(allDownloadableLinks.map(t=>fetch(t).then(e=>e.blob()).then(e=>(e.name=t.slice(t.lastIndexOf("/")+1),e)))),packToZip=e=>{if(window.JSZip){let t=new window.JSZip;return e.forEach(e=>t.file(e.name,e)),t.generateAsync({type:"blob"})}return null},generateBlobFile=()=>{generateBlob().catch(e=>console.error(e,"File could not be generated 1")).then(packToZip).catch(e=>console.error(e,"File could not be generated 2")).then(r=>{downloadBtn&&r&&downloadBtn.addEventListener("click",e=>{e.preventDefault();var e=URL.createObjectURL(r),t=document.createElement("a");t.href=e,t.download="wmk_downloads.zip",document.body.appendChild(t),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.body.removeChild(t)})}).catch(e=>console.error(e,"File could not be generated 3"))};export default function decorate(e){let t=e.children[0];t&&t.classList.add("text-content");var r=t.children[0],r=(r&&r.classList.add("title"),t.children[2]),r=(r&&r.querySelector("p")&&(r.classList.add("download-link"),r=r.querySelector("p"),downloadBtn.setAttribute("href","#"),downloadBtn.textContent=r.textContent,r.replaceWith(downloadBtn)),Array.from(e.children).filter(e=>e!==t));let n=document.createElement("div"),a=(n.classList.add("assets-container"),r.forEach(e=>n.appendChild(e)),e.appendChild(n),document.querySelector(".assets-container"));r=a.children,e=Array.from(r).map(e=>Array.from(e.children)).flat();Array.from(r).forEach(e=>e.remove()),e.forEach(e=>a.appendChild(e));let o=Array.from(a.children);setTimeout(()=>{o.forEach((e,t)=>{var r,n,o,l=e.querySelector("p:nth-child(3) em a");l&&l.getAttribute("href")&&((o=getDocFileExtension((l.href||"").toLowerCase()))&&l.getAttribute("href")&&l.href.toLowerCase().includes("wellmark.com")&&((n=new URL(l.href)).hash="",n.search="",allDownloadableLinks.push(n.toString())),n=e.querySelector("p:nth-child(2)"),(r=document.createElement("a")).classList.add("asset-download-anchor"),r.textContent=n.textContent,r.setAttribute("href",l.getAttribute("href")),n.replaceWith(r),r.innerHTML="pdf"===o?r.textContent+'<i class="fa-regular fa-file-pdf"></i>':r.textContent+'<i class="fa-regular fa-download"></i>',n=e.querySelector("p:nth-child(1)"),(o=document.createElement("a")).classList.add("asset-download-img"),o.innerHTML=n.innerHTML,o.setAttribute("href",l.getAttribute("href")),n.replaceWith(o),l.closest("p").remove(),o.setAttribute("target","_blank"),r.setAttribute("target","_blank"),t===Array.from(a.querySelectorAll("em")).length-1)&&generateBlobFile()})},1500)}