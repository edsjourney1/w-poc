import{buildBlock,loadHeader,loadFooter,decorateButtons,decorateIcons,decorateSections,decorateBlocks,decorateTemplateAndTheme,getMetadata,waitForFirstImage,loadSection,loadSections,loadCSS,sampleRUM,loadPublishedDate,loadExternalPopup,loadCommonFragments,loadScript,toCamelCase,toClassName}from"./aem.js";import decorateExternalImages from"./externalImage.js";import{orderlist,scrollIdlink,windowUrlDetails}from"./tools.js";let AUDIENCES={mobile:()=>window.innerWidth<752,desktop:()=>752<=window.innerWidth};function getAllMetadata(a){return[...document.head.querySelectorAll(`meta[property^="${a}:"],meta[name^="${a}-"]`)].reduce((e,t)=>(e[toClassName(t.name?t.name.substring(a.length+1):t.getAttribute("property").split(":")[1])]=t.getAttribute("content"),e),{})}let pluginContext={getAllMetadata:getAllMetadata,getMetadata:getMetadata,loadCSS:loadCSS,loadScript:loadScript,sampleRUM:sampleRUM,toCamelCase:toCamelCase,toClassName:toClassName};function buildHeroBlock(e){var t,a=e.querySelector("h1"),o=e.querySelector("picture");a&&o&&a.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_PRECEDING&&((t=document.createElement("div")).append(buildBlock("hero",{elems:[o,a]})),e.prepend(t))}function createElement(){return null}function updateLists(){var e=Array.from(document.querySelectorAll("li:first-child"));let o=1,l="disc";e.forEach(e=>{var t=((e.innerHTML||e.textContent).match(/#.*?#/g)||[])[0];if(t){var a=t.substring(1,t.length-1).split("--");if("type"===a[0]){switch(a[1]){case"A":o="A";break;case"a":o="a";break;case"I":o="I";break;case"i":o="i";break;case"solid":l="disc";break;case"circle":l="circle";break;case"square":l="square"}e.closest("ol")?.setAttribute("type",o),e.closest("ul")?.setAttribute("type",l),-1<t.indexOf("first-letter-bold")&&(e.closest("ol")?.classList.add("first-letter-bold"),e.closest("ul")?.classList.add("first-letter-bold")),e.innerHTML=e.innerHTML.replace(/#.*?#/gi,"")}}})}async function loadFonts(){await loadCSS(window.hlx.codeBasePath+"/styles/fonts.css");try{window.location.hostname.includes("localhost")||sessionStorage.setItem("fonts-loaded","true")}catch(e){}}function autolinkModals(){}function buildAutoBlocks(e){try{buildHeroBlock(e)}catch(e){console.error("Auto Blocking failed",e)}}function decorateMain(e){decorateButtons(e),decorateIcons(e),buildAutoBlocks(e),decorateSections(e),decorateBlocks(e),decorateExternalImages(e),orderlist(),scrollIdlink()}async function loadEager(e){windowUrlDetails.origin.indexOf("localhost")<0&&(getMetadata("experiment")||Object.keys(getAllMetadata("content")).length||Object.keys(getAllMetadata("audience")).length)&&(t=(await import("../plugins/experimentation/src/index.js")).loadEager,await t(document,{audiences:AUDIENCES,campaignsMetaTagPrefix:"content",campaignsQueryParameter:"content"},pluginContext)),e.documentElement.lang="en",loadHeader(e.querySelector("header")),loadFooter(e.querySelector("footer")),loadPublishedDate(),decorateTemplateAndTheme(),"true"===getMetadata("breadcrumbs").toLowerCase()&&(e.body.dataset.breadcrumbs=!0);var t=e.querySelector("main");t&&(decorateMain(t),e.body.classList.add("appear"),await loadSection(t.querySelector(".section"),waitForFirstImage)),sampleRUM.enhance();try{(900<=window.innerWidth||sessionStorage.getItem("fonts-loaded"))&&(loadFonts(),updateLists())}catch(e){}}async function loadLazy(e){autolinkModals(e);var t=e.querySelector("main"),a=e.querySelector("body"),t=(await loadSections(t),window.location).hash,e=!!t&&e.getElementById(t.substring(1));t&&e&&e.scrollIntoView(),loadCommonFragments(a),loadExternalPopup(a),loadFonts(),windowUrlDetails.origin.indexOf("localhost")<0&&(getMetadata("experiment")||Object.keys(getAllMetadata("content")).length||Object.keys(getAllMetadata("audience")).length)&&(t=(await import("../plugins/experimentation/src/index.js")).loadLazy,await t(document,{audiences:AUDIENCES,campaignsMetaTagPrefix:"content",campaignsQueryParameter:"content"},pluginContext))}function loadDelayed(){window.setTimeout(()=>import("./delayed.js"),3e3)}async function loadPage(){await loadEager(document),await loadLazy(document),loadDelayed()}window.addEventListener("load",()=>{var t=window.location.hash;let a;if(a=t?document.querySelector(t):a){let e;t=window.outerWidth;switch(!0){case 1920<=t:case 1024<=t:e=170;break;case 480<=t:e=90;break;default:e=85}setTimeout(()=>{window.scrollTo({behavior:"smooth",top:a.getBoundingClientRect().top+window.scrollY-e})},500)}}),loadPage();export{getAllMetadata,createElement,decorateMain};