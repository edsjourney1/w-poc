import{getAssetId,getDocFileExtension,windowUrlDetails}from"./tools.js";let dL=window.adobeDataLayer,allClickables=[],analyticsElements=[],analyticsFormsArr=[],analyticsFaqArr=[],urlDetails=windowUrlDetails,allAssetsNames=[],allAssetsTypes=[],allAssetsIds=[],bodyEl=document.body,isRelativeURL=e=>new URL(e,window.location.href).origin===window.location.origin,isOutboundLink=e=>{let t=!1;return isRelativeURL(e)?t=!1:new URL(e).hostname!==window.location.hostname&&(t=!0),t},createEventData=e=>e?{eventData:{...e}}:{eventData:{}},pushToAdobe=(e={})=>{bodyEl.classList.contains("sidekick-library")||(console.log("\n\n\n============== (FOR DATA TRACKING TESTING ONLY) ==============\n",JSON.stringify(e),"\n==============\n\n\n"),dL.push(e))},analyticsClick=e=>{pushToAdobe({event:"click",...createEventData(e)})},analyticsNavigation=e=>{pushToAdobe({event:"navigation",...createEventData(e)})},analyticsCallToAction=e=>{pushToAdobe({event:"call_to_action",...createEventData(e)})},analyticsModal=e=>{pushToAdobe({event:"modal",...createEventData(e)})},analyticsFileDownload=e=>{pushToAdobe({event:"file_download",...createEventData(e)})},analyticsForms=e=>{pushToAdobe({event:"forms",...createEventData(e)})},analyticsContact=e=>{pushToAdobe({event:"contact",...createEventData(e)})},analyticsFAQ=e=>{pushToAdobe({event:"faq",...createEventData(e)})},analyticsSocial=e=>{pushToAdobe({event:"social",...createEventData(e)})},analyticsPageView=e=>{pushToAdobe({event:"page_view",...createEventData(e)})},gatherOtherAssets=()=>{document.querySelectorAll('img, iframe, video source, [name="video-embed-src"]').forEach(e=>{var t=e.src||e.value||"",a=getDocFileExtension(t),s=e.getAttribute("data-videourl")?getAssetId(e.getAttribute("data-videourl")):getAssetId(t);a&&(allAssetsNames.push(new URL(e.getAttribute("data-videourl")||t).pathname.split("/").filter(e=>e).pop()),allAssetsTypes.push(a),allAssetsIds.push(s.replace("urn:aaid:aem:","")))}),analyticsPageView({account_login_status:"logged out",age:"undefined",audience_role:"undefined",audience_size:"undefined",audience_type:"undefined",environment:"www.wellmark.com"===urlDetails.hostname?"PROD":"DEV",gender:"undefined",page_type:"undefined",site_name:"wellmark",site_section:urlDetails.pathname.split("/").filter(e=>e).join("|"),site_subcategory_depth:urlDetails.pathname.split("/").filter(e=>e).length,site_subcategory:urlDetails.pathname.split("/").filter(e=>e)[0]||"undefined",user_id:0,user_relationship_to_member:"undefined",user_role:"undefined",user_type:"undefined",asset_name:allAssetsNames.filter(e=>e).join("|"),asset_type:allAssetsTypes.filter(e=>e).join("|").toLowerCase(),asset_id:allAssetsIds.filter(e=>e).join("|")})},faqAnalyticsInit=()=>{Array.from(document.querySelectorAll(".accordion-container .accordion-item")).forEach(e=>{e={el:e,question:e.querySelector(".item-title").innerText||e.querySelector(".item-title").textContent,faq_name:null,faq_toggle:null,summary:e.querySelector("summary")};analyticsFaqArr.push(e)});analyticsFaqArr.forEach(t=>{t.summary.addEventListener("click",()=>{var e;(e=t).el.attributes?.open?analyticsFAQ({faq_question:e.question,faq_name:e.question,faq_toggle:"collapse"}):analyticsFAQ({faq_question:e.question,faq_name:e.question,faq_toggle:"expand"})},!1)})},linksAnalyticsInit=()=>{var e=document.querySelectorAll(".siteheader-mobile-wrapper > nav > ul > li"),t=document.querySelectorAll(".siteheader-blog-menu > ul > li");let o=Array.from(e),r=t&&Array.from(t),c=document.querySelector(".siteheader-login-wrapper button"),u=document.querySelector(".siteheader-mobile-wrapper > button"),d=document.querySelector(".siteheader-search-wrapper > button");allClickables.forEach((s,e)=>{var i={alt:s.querySelector("img")?.getAttribute("alt"),isHeader:s.classList?.contains("siteheader-has-subnav"),isBlueHeader:s.classList?.contains("siteheader-blog-has-subnav"),isdialogpopup:"dialog"===s.getAttribute("aria-haspopup"),isLoginBtn:s===c,isMenuButton:s===u,isSearchButton:s===d,isBreadcrumb:s.closest(".breadcrumbs"),assetId:null,assetName:null,assetType:null,blogNav:s.closest(".siteheader-blog"),classList:s.getAttribute("class"),contact:null,contactCount:0,contactDescriptor:null,contactLocation:null,ctaElementType:"button",ctaLocation:null,dataAttrs:[],display:null,domain:null,el:s,extn:null,footer:s.closest("footer"),hasModal:!1,header:s.closest("header"),href:s.href,id:s.getAttribute("id"),img:s.querySelector("img"),imgUrlDetails:null,isCTA:null,isJumpLink:"#"===s.getAttribute("href")?.indexOf(0),label:s.getAttribute("aria-label")||"",mainNav:s.closest(".siteheader-mobile-wrapper"),menuType:null,modal:s.closest("dialog"),outbound:!1,popup:null,social:null,socialClick:0,tag:s.tagName.toLowerCase(),text:s.innerText||s.textContent,title:s.getAttribute("title")||"",urlDetails:null},t=(i.href||"").toLowerCase();0<t.length&&(i.urlDetails=new URL(t),i.domain=i.urlDetails?.host,i.extn=getDocFileExtension(t)),i.img&&(i.imgUrlDetails=new URL(i.img.src),i.assetType=getDocFileExtension(i.img.src),i.assetId=getAssetId(i.img.src));let a;i.extn&&(n=i.urlDetails?.pathname.split("/").filter(e=>e).pop(),i.assetName=n,i.assetType=i.extn,allAssetsNames.push(i.assetName),allAssetsTypes.push(i.extn),0<(a=getAssetId(i.href)).length)&&(i.assetId=a,allAssetsIds.push(a.replace("urn:aaid:aem:",""))),a="",i.assetType&&(n=i.urlDetails?.pathname.split("/").filter(e=>e).pop(),i.assetName=n,i.alt||(i.alt=n),(i.img||{}).src)&&0<(a=getAssetId(i.img.src)).length&&allAssetsIds.push(a.replace("urn:aaid:aem:",""));var n=t.match(/^tel:([^?]+)/),l=t.match(/^mailto:([^?]+)/);(t.startsWith("mailto:")||t.startsWith("tel:"))&&(i.contactLocation="body",i.header&&(i.contactLocation="header"),i.footer&&(i.contactLocation="footer"),i.dialog)&&(i.contactLocation="dialog"),t.startsWith("mailto:")&&(i.contact="email",l)&&([l]=l,i.contactDescriptor=l),t.startsWith("tel:")&&(i.contact="phone",n)&&([l]=n,i.contactDescriptor=l),i.contactDescriptor||(i.contactDescriptor="undefined"),i.urlDetails?.origin.includes("facebook")&&(i.social="facebook"),i.urlDetails?.origin.includes("linkedin")&&(i.social="linkedin"),(i.urlDetails?.origin.includes("twitter")||i.urlDetails?.origin.includes(".x.com")||i.urlDetails?.origin.includes("/x.com"))&&(i.social="x"),i.urlDetails?.origin.includes("youtube")&&(i.social="youtube"),i.urlDetails?.origin.includes("instagram")&&(i.social="instagram"),i.display=getComputedStyle(s).display.toLowerCase(),i.isCTA=!("inline"===i.display||i.img||o.includes(s.parentElement)||r.includes(s.parentElement)||i.isLoginBtn||i.isSearchButton||i.isMenuButton),i.isCTA&&(i.ctaLocation="body",i.header&&(i.ctaLocation="header"),i.footer&&(i.ctaLocation="footer"),i.dialog)&&(i.ctaLocation="dialog"),i.text||(i.text=s.getAttribute("aria-label")||""),i.menuType=i.header?"header":i.footer?"footer":i.isBreadcrumb?"breadcrumbs":"body",i.outbound=isOutboundLink(i.href),analyticsElements.push(i);for(let e=0,t=s.attributes,a=t.length;e<a;e+=1)t[e].nodeName.startsWith("data")&&i.dataAttrs.push({node:t[e].nodeName,value:t[e].value});e===allClickables.length-1&&gatherOtherAssets()}),analyticsElements.forEach(e=>{e.el.addEventListener("click",()=>{e.outbound&&!e.isdialogpopup&&(e.contact?(e.contactCount+=1,analyticsContact({contact_count:e.contactCount,contact_location:e.contactLocation,contact_method:e.contact,contact_descriptor:e.contactDescriptor})):e.social?(e.socialClick+=1,analyticsSocial({social_network:e.social,social_share:"undefined",social_clickthrough:e.socialClick})):e.extn?analyticsFileDownload({file_extension:e.extn,file_name:e.assetName,link_classes:e.classList,link_domain:e.domain,link_id:e.id,link_text:e.text,link_url:e.href,asset_name:e.assetName,asset_type:e.assetType,asset_id:e.assetId}):analyticsClick({link_classes:e.classList||"undefined",link_domain:e.domain,link_id:e.id||"undefined",link_text:e.text,link_url:e.href,asset_name:e.assetName,asset_type:e.assetType,asset_id:e.assetId,outbound:!0})),e.outbound||(e.isCTA&&!e.isHeader?analyticsCallToAction({link_url:e.href||0,cta_click_image_alt_text:e.alt,cta_click_text:e.text,cta_element_type:e.ctaElementType,cta_location:e.ctaLocation,cta_type:e.tag,asset_name:e.assetName||"undefined",asset_type:e.assetType||"undefined",asset_id:e.assetId||"undefined"}):e.extn?analyticsFileDownload({file_extension:e.extn,file_name:e.assetName,link_classes:e.classList,link_domain:e.domain,link_id:e.id,link_text:e.text,link_url:e.href,asset_name:e.assetName,asset_type:e.assetType,asset_id:e.assetId}):e.isHeader||e.isBlueHeader||e.isdialogpopup||e.isLoginBtn||e.isSearchButton||e.isMenuButton||analyticsNavigation({link_url:e.href||"0",nav_click_image_alt_text:e.alt||"undefined",nav_click_text:e.text,nav_menu_type:e.menuType,asset_name:e.assetName||"undefined",asset_type:e.assetType||"undefined",asset_id:e.assetId||"undefined"}))})})},formAnalyticsInit=()=>{Array.from(document.querySelectorAll("form")).forEach(e=>{e.classList.contains("eds-mkto-form")||(e={el:e,action:e.getAttribute("action")||"",category:null,errorblock:null,errorLabel:"",id:e.getAttribute("id")||"",inputErrorCount:0,method:e.getAttribute("method")||"",name:e.getAttribute("name")||"",start:!0,step:1,submitCount:0,techErrorCount:0},analyticsFormsArr.push(e))}),analyticsFormsArr.forEach(a=>{"gn-loginForm"!==a.id&&"gn-loginForm-mobile"!==a.id||(a.errorblock=a.el.closest(".siteheader-login-wrapper-grid")?.querySelector(".form-error-block")),a.el.addEventListener("submit",()=>{a.submitCount+=1,setTimeout(()=>{var e=a.errorblock?.querySelectorAll("li")||[];let t="";e.forEach(e=>{t+=`${e.innerText||e.textContent||""},`}),analyticsForms({form_action:a.action,form_category:a.category,form_error_label:t,form_input_error_count:e.length||"0",form_name:a.name,form_start:a.start,form_step:a.step,form_submit_count:a.submitCount,form_tech_error_count:0})},500)})})},analyticsInit=()=>{bodyEl.classList.contains("sidekick-library")||(allClickables=Array.from(document.querySelectorAll("a, button")),formAnalyticsInit(),linksAnalyticsInit(),faqAnalyticsInit())},trackYTStart=e=>{pushToAdobe({event:"video_start",...createEventData(e)})},trackYTPause=e=>{pushToAdobe({event:"video_pause",...createEventData(e)})},trackYTResume=e=>{pushToAdobe({event:"video_resume",...createEventData(e)})},trackYTProgress=e=>{pushToAdobe({event:"video_progress",...createEventData(e)})},trackYTComplete=e=>{pushToAdobe({event:"video_complete",...createEventData(e)})};export{analyticsClick,analyticsNavigation,analyticsInit,analyticsModal,trackYTStart,trackYTPause,trackYTResume,trackYTProgress,trackYTComplete};